<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>TutorFinder Pro - Custom Update</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <style>
        :root { 
            --primary: #FF6F00; 
            --primary-gradient: linear-gradient(135deg, #FF6F00, #FF9100);
            --secondary: #2C3E50;
            --user-color: #3498db;
            --light-bg: #f8f9fa;
        }
        
        html, body { 
            height: 100%; margin: 0; padding: 0; 
            overflow: hidden; 
            font-family: 'Segoe UI', 'AdorshoLipi', sans-serif;
            background-color: #f4f7f6;
        }

        .app-container {
            display: flex; flex-direction: column; width: 100%; max-width: 480px;
            height: 100dvh; margin: 0 auto; background: white;
            position: relative; box-shadow: 0 0 25px rgba(0,0,0,0.1);
        }

        #map { flex: 1; width: 100%; z-index: 1; }

        /* সার্চ বক্স */
        .search-wrapper { position: absolute; top: 15px; left: 15px; right: 15px; z-index: 1100; }
        .search-box {
            display: flex; background: white; padding: 12px 18px; border-radius: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); align-items: center;
        }
        .search-box input { flex: 1; border: none; outline: none; font-size: 15px; margin-left: 10px; }
        .suggestion-list {
            background: white; border-radius: 15px; margin-top: 8px;
            max-height: 200px; overflow-y: auto; display: none;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15); border: 1px solid #eee;
        }
        .suggestion-item { padding: 12px 18px; border-bottom: 1px solid #f1f1f1; cursor: pointer; font-size: 14px; }

        /* পিন ডিজাইন */
        .tuition-pin { background: var(--primary); border: 3px solid white; border-radius: 50% 50% 50% 0; transform: rotate(-45deg); width: 32px !important; height: 32px !important; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .tuition-pin i { transform: rotate(45deg); color: white; font-size: 12px; }
        .user-pin { background: var(--user-color); border: 3px solid white; border-radius: 50%; width: 35px !important; height: 35px !important; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 15px rgba(52, 152, 219, 0.5); }

        /* পপ-আপ কার্ড ডিজাইন */
        .leaflet-popup-content-wrapper { border-radius: 16px; padding: 0; overflow: hidden; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .leaflet-popup-content { margin: 0 !important; width: 240px !important; }
        .pop-card { background: white; }
        .pop-header { background: #fff4e5; color: #e65100; padding: 12px; text-align: center; font-weight: bold; font-size: 14px; border-bottom: 1px solid #ffe0b2; }
        .pop-body { padding: 15px; }
        .pop-info { margin-bottom: 8px; font-size: 13.5px; color: #444; display: flex; align-items: center; gap: 8px; }
        .pop-info i { color: var(--primary); width: 15px; }
        .dist-badge { color: #d35400; font-weight: bold; }
        .btn-pop-details { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; font-size: 14px; }

        /* সোয়াইপযোগ্য ড্রয়ার */
        #drawer {
            position: fixed; bottom: -100%; left: 0; right: 0;
            background: white; z-index: 4000; border-radius: 25px 25px 0 0;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.2); transition: bottom 0.4s cubic-bezier(0.25, 1, 0.5, 1);
            max-width: 480px; margin: 0 auto;
        }
        #drawer.active { bottom: 0; }
        .drawer-handle { padding: 15px 0; cursor: grab; display: flex; justify-content: center; touch-action: none; }
        .drawer-bar { width: 50px; height: 5px; background: #e0e0e0; border-radius: 10px; }
        .drawer-content { padding: 0 25px 40px; max-height: 70vh; overflow-y: auto; }
        .close-icon { position: absolute; top: 15px; right: 20px; font-size: 22px; color: #ccc; cursor: pointer; }

        /* ডানদিকের ফ্লোটিং বাটনসমূহ (My Area & Radius Booster) */
        .map-controls {
            position: absolute; bottom: 100px; right: 20px; 
            display: flex; flex-direction: column; gap: 12px; z-index: 1000;
        }
        
        /* My Area Button */
        .my-area-btn {
            background: white; color: var(--secondary);
            padding: 8px 15px; border-radius: 20px;
            display: flex; align-items: center; gap: 8px;
            font-weight: 600; font-size: 13px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            border: 1px solid #eee; cursor: pointer;
            transition: all 0.3s;
        }
        .my-area-btn i { color: var(--user-color); font-size: 16px; }
        .my-area-btn:active { transform: scale(0.95); background: #f0f0f0; }

        /* Radius Booster Button */
        .radius-booster { 
            background: var(--primary-gradient); color: white; 
            width: 54px; height: 54px; border-radius: 18px; 
            display: flex; align-items: center; justify-content: center; 
            box-shadow: 0 6px 20px rgba(255,111,0,0.4); 
            border: 2px solid white; cursor: pointer;
            margin-left: auto; /* অ্যালাইনমেন্ট ঠিক রাখার জন্য */
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .radius-booster:active { transform: scale(0.9) rotate(15deg); }
        .radius-booster i { font-size: 20px; }

        /* প্রিমিয়াম মডাল */
        #premium-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); backdrop-filter: blur(4px); z-index: 5000; display: none; align-items: center; justify-content: center; padding: 20px; }
        .modal-card { background: white; width: 100%; max-width: 360px; border-radius: 30px; overflow: hidden; animation: slideUp 0.3s ease-out; }
        
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .plan-option { 
            display: flex; justify-content: space-between; padding: 18px; 
            border: 2px solid #f0f0f0; border-radius: 20px; 
            margin-bottom: 12px; cursor: pointer; transition: all 0.2s;
        }
        .plan-option.active { border-color: var(--primary); background: #fff8f1; }
        .plan-option:hover { border-color: #ffd180; }

        /* বটম মেনু */
        .bottom-nav { height: 75px; background: white; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #f0f0f0; z-index: 1001; padding-bottom: env(safe-area-inset-bottom); }
        .nav-item { text-align: center; color: #ABB7B7; text-decoration: none; font-size: 11px; flex: 1; }
        .nav-item i { font-size: 22px; display: block; margin-bottom: 4px; }
        .nav-item.active { color: var(--primary); }
    </style>
</head>
<body>

<div class="app-container">
    <div class="search-wrapper">
        <div class="search-box">
            <i class="fas fa-search" style="color: var(--primary);"></i>
            <input type="text" id="loc-search" placeholder="এলাকা লিখে সার্চ করুন..." autocomplete="off">
        </div>
        <div id="suggestion-box" class="suggestion-list"></div>
    </div>

    <div id="map"></div>

    <div class="map-controls">
        <div class="my-area-btn" onclick="goToMyLocation()">
            <i class="fas fa-location-crosshairs"></i> My Area
        </div>
        <div class="radius-booster" onclick="toggleModal(true)">
            <i class="fas fa-tower-broadcast"></i>
        </div>
    </div>

    <div id="drawer">
        <div class="drawer-handle" id="drag-handle"><div class="drawer-bar"></div></div>
        <i class="fas fa-times-circle close-icon" onclick="closeDrawer()"></i>
        <div class="drawer-content" id="drawer-body"></div>
    </div>

    <div id="premium-modal">
        <div class="modal-card">
            <div style="background: var(--primary-gradient); color:white; padding:35px 25px; text-align:center; position: relative;">
                <div style="position: absolute; top: -10px; right: -10px; opacity: 0.1; font-size: 100px;"><i class="fas fa-rss"></i></div>
                <i class="fas fa-bolt-lightning" style="font-size:40px; margin-bottom:15px; text-shadow: 0 4px 10px rgba(0,0,0,0.2);"></i>
                <h2 style="margin:0; font-size: 24px; letter-spacing: 1px;">রেডিয়াস বুস্টার</h2>
                <p style="margin: 5px 0 0; font-size: 13px; opacity: 0.9;">আপনার এলাকা বড় করুন, বেশি টিউশন পান</p>
            </div>
            <div style="padding:25px;">
                <div class="plan-option active">
                    <div>
                        <b style="font-size: 15px;">রেগুলার টিউটর (৫ কিমি)</b><br>
                        <small style="color:#888;"><i class="fas fa-circle-check"></i> বর্তমানে সক্রিয় আছে</small>
                    </div>
                    <div style="color: #2ecc71; font-weight: 800; font-size: 16px;">ফ্রি</div>
                </div>
                <div class="plan-option" onclick="alert('পেমেন্ট গেটওয়ে লোড হচ্ছে...')">
                    <div>
                        <b style="font-size: 15px;">পাওয়ার টিউটর (১০ কিমি)</b><br>
                        <small style="color:#888;"><i class="fas fa-fire"></i> ২ গুণ বেশি টিউশন দেখা যাবে</small>
                    </div>
                    <div style="color: var(--primary); font-weight: 800; font-size: 16px;">৳ ১০০</div>
                </div>
                <div class="plan-option" onclick="alert('পেমেন্ট গেটওয়ে লোড হচ্ছে...')">
                    <div>
                        <b style="font-size: 15px;">সুপার টিউটর (১৫ কিমি)</b><br>
                        <small style="color:#888;"><i class="fas fa-star"></i> সর্বোচ্চ টিউশন সুবিধা</small>
                    </div>
                    <div style="color: var(--primary); font-weight: 800; font-size: 16px;">৳ ১৫০</div>
                </div>
                <button onclick="toggleModal(false)" style="width:100%; padding:16px; border:none; background:#f5f5f5; border-radius:18px; font-weight:700; color:#666; margin-top: 10px; cursor:pointer;">পরে করবো</button>
            </div>
        </div>
    </div>

    <nav class="bottom-nav">
        <a href="#" class="nav-item"><i class="fas fa-home"></i>Home</a>
        <a href="#" class="nav-item active"><i class="fas fa-map-location-dot"></i>My Map</a>
        <a href="#" class="nav-item"><i class="fas fa-message"></i>Live Chat</a>
        <a href="#" class="nav-item"><i class="fas fa-chart-pie"></i>Dashboard</a>
        <a href="#" class="nav-item"><i class="fas fa-user-circle"></i>Profile</a>
    </nav>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    var map = L.map('map', { zoomControl: false }).setView([23.8103, 90.4125], 13);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);

    const uIcon = L.divIcon({ html: '<div class="user-pin"><i class="fas fa-user-graduate" style="color:white"></i></div>', className: '', iconSize: [35, 35] });
    const tIcon = L.divIcon({ html: '<div class="tuition-pin"><i class="fas fa-book-open"></i></div>', className: '', iconSize: [32, 32], iconAnchor: [16, 32] });

    let userMarker, rangeCircle, markers = [];
    let currentLat, currentLon;
    let myLat, myLon; // লাইভ লোকেশন সংরক্ষণের জন্য

    function getDistance(lat1, lon1, lat2, lon2) {
        var R = 6371;
        var dLat = (lat2 - lat1) * Math.PI / 180;
        var dLon = (lon2 - lon1) * Math.PI / 180;
        var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
        var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        return (R * c).toFixed(2);
    }

    // ১. লাইভ লোকেশনে ফিরে যাওয়ার ফাংশন (My Area)
    function goToMyLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(p => {
                myLat = p.coords.latitude;
                myLon = p.coords.longitude;
                updateMap(myLat, myLon);
            }, () => {
                alert("লোকেশন পারমিশন প্রয়োজন!");
            });
        }
    }

    const searchInput = document.getElementById('loc-search');
    const suggestBox = document.getElementById('suggestion-box');

    searchInput.addEventListener('input', async (e) => {
        const query = e.target.value;
        if (query.length < 3) { suggestBox.style.display = 'none'; return; }
        try {
            const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${query}&countrycodes=bd&limit=5`);
            const data = await res.json();
            suggestBox.innerHTML = '';
            if (data.length > 0) {
                suggestBox.style.display = 'block';
                data.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'suggestion-item';
                    div.innerHTML = `<i class="fas fa-location-dot"></i> ${item.display_name}`;
                    div.onclick = () => {
                        searchInput.value = item.display_name;
                        suggestBox.style.display = 'none';
                        updateMap(item.lat, item.lon);
                    };
                    suggestBox.appendChild(div);
                });
            }
        } catch (err) {}
    });

    function updateMap(lat, lon) {
        currentLat = parseFloat(lat);
        currentLon = parseFloat(lon);
        const pos = [currentLat, currentLon];
        
        map.setView(pos, 14);
        if (userMarker) map.removeLayer(userMarker);
        if (rangeCircle) map.removeLayer(rangeCircle);
        markers.forEach(m => map.removeLayer(m));

        userMarker = L.marker(pos, {icon: uIcon}).addTo(map);
        rangeCircle = L.circle(pos, { radius: 5000, color: '#FF6F00', weight: 1.5, fillOpacity: 0.05, dashArray: '5, 5' }).addTo(map);

        const titles = ["ছেলে শিক্ষক প্রয়োজন", "মেয়ে শিক্ষক প্রয়োজন", "শিক্ষক প্রয়োজন"];
        const classes = ["৫ম শ্রেণি", "৮ম শ্রেণি", "১০ম শ্রেণি", "এইচএসসি"];
        const salaries = ["৩০০০/-", "৫০০০/-", "৮০০০/-", "১২০০০/-"];
        const subjects = ["গণিত ও বিজ্ঞান", "ইংরেজি ভার্সন", "অল সাবজেক্ট", "পদার্থ ও রসায়ন"];

        for (let i = 0; i < 20; i++) {
            const tLat = pos[0] + (Math.random() - 0.5) * 0.12; 
            const tLon = pos[1] + (Math.random() - 0.5) * 0.12;
            const dist = getDistance(pos[0], pos[1], tLat, tLon);
            
            const randTitle = titles[Math.floor(Math.random() * titles.length)];
            const randClass = classes[Math.floor(Math.random() * classes.length)];
            const randSal = salaries[Math.floor(Math.random() * salaries.length)];
            const randSub = subjects[Math.floor(Math.random() * subjects.length)];

            const marker = L.marker([tLat, tLon], {icon: tIcon}).addTo(map);
            marker.bindPopup(`
                <div class="pop-card">
                    <div class="pop-header">${randTitle}</div>
                    <div class="pop-body">
                        <div class="pop-info"><i class="fas fa-person-walking"></i> <b>দূরত্ব:</b> <span class="dist-badge">${dist} কিমি</span></div>
                        <div class="pop-info"><i class="fas fa-graduation-cap"></i> <b>শ্রেণি:</b> ${randClass}</div>
                        <div class="pop-info"><i class="fas fa-sack-dollar"></i> <b>সম্মানী:</b> ${randSal}</div>
                        <div class="pop-info"><i class="fas fa-book"></i> <b>বিষয়:</b> ${randSub}</div>
                    </div>
                    <button class="btn-pop-details" onclick="openDrawer('${randTitle}', '${randClass}', '${randSal}', '${randSub}', ${dist})">বিস্তারিত দেখুন</button>
                </div>
            `);
            markers.push(marker);
        }
    }

    function openDrawer(title, cls, sal, sub, dist) {
        document.getElementById('drawer-body').innerHTML = `
            <h2 style="color:var(--primary); margin-bottom:5px;">${title}</h2>
            <p style="color:#666; margin-bottom:10px;"><i class="fas fa-location-dot"></i> লোকেশন: আপনার এলাকার কাছাকাছি</p>
            <p style="margin-bottom:20px; font-weight:bold; color:var(--primary); font-size:15px;"><i class="fas fa-person-walking"></i> আপনার থেকে দূরত্ব: ${dist} ki.m.</p>
            
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:25px;">
                <div style="background:var(--light-bg); padding:15px; border-radius:15px; border:1px solid #eee;">
                    <small style="color:#999; display:block; margin-bottom:5px;">শ্রেণি</small>
                    <b style="font-size:16px;">${cls}</b>
                </div>
                <div style="background:var(--light-bg); padding:15px; border-radius:15px; border:1px solid #eee;">
                    <small style="color:#999; display:block; margin-bottom:5px;">সম্মানী</small>
                    <b style="font-size:16px;">${sal}</b>
                </div>
                <div style="background:var(--light-bg); padding:15px; border-radius:15px; border:1px solid #eee;">
                    <small style="color:#999; display:block; margin-bottom:5px;">বিষয়সমূহ</small>
                    <b style="font-size:14px;">${sub}</b>
                </div>
                <div style="background:var(--light-bg); padding:15px; border-radius:15px; border:1px solid #eee;">
                    <small style="color:#999; display:block; margin-bottom:5px;">সময়কাল</small>
                    <b style="font-size:14px;">সপ্তাহে ৩/৪ দিন</b>
                </div>
            </div>
            <p style="line-height:1.6; color:#444; font-size:14.5px;">শিক্ষার্থীর পড়াশোনার মানোন্নয়নে একজন অভিজ্ঞ ও দায়িত্বশীল গৃহশিক্ষক খুঁজছি। বিস্তারিত জানতে আবেদন করুন।</p>
            <button onclick="applyTuition(${dist})" style="width:100%; padding:16px; background:var(--primary); color:white; border:none; border-radius:16px; font-weight:bold; font-size:16px; margin-top:20px; box-shadow: 0 4px 15px rgba(255,111,0,0.3);">আবেদন করুন</button>
        `;
        document.getElementById('drawer').classList.add('active');
        map.closePopup();
    }

    function applyTuition(dist) {
        if (dist > 5) {
            alert("টিউশনটি তোমার লাইভ লোকেশনের ৫ কিলোমিটারের মধ্যে নেই। অনুগ্রহ করে রেডিয়াস বুস্টার ব্যবহার করো।");
        } else {
            alert('আবেদন সফল! আমরা আপনার সাথে যোগাযোগ করব।');
        }
    }

    function closeDrawer() { document.getElementById('drawer').classList.remove('active'); }

    let startY = 0;
    const drw = document.getElementById('drawer');
    const hnd = document.getElementById('drag-handle');
    hnd.addEventListener('touchstart', (e) => startY = e.touches[0].clientY);
    hnd.addEventListener('touchmove', (e) => {
        let moveY = e.touches[0].clientY - startY;
        if (moveY > 0) drw.style.bottom = `-${moveY}px`;
        if (moveY > 150) { closeDrawer(); drw.style.bottom = '-100%'; }
    });
    hnd.addEventListener('touchend', () => { if (drw.classList.contains('active')) drw.style.bottom = '0'; });

    function toggleModal(show) { document.getElementById('premium-modal').style.display = show ? 'flex' : 'none'; }

    // শুরুতে লোকেশন সেট করা
    goToMyLocation();
</script>

</body>
</html>
